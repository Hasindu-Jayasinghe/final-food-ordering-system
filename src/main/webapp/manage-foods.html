<!DOCTYPE html>
<html>
<head>
    <title>Food_Template Bootstrap Responsive Website Template | Contact :: w3layouts</title>
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css'/>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.min.js"></script>
    <!-- Custom Theme files -->
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
    <!-- Custom Theme files -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
    <!--webfont-->
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic'
          rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lobster+Two:400,400italic,700,700italic' rel='stylesheet'
          type='text/css'>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <!--Animation-->
    <script src="js/wow.min.js"></script>
    <link href="css/animate.css" rel='stylesheet' type='text/css'/>
    <script>
        new WOW().init();
    </script>
    <script type="text/javascript" src="js/move-top.js"></script>
    <script type="text/javascript" src="js/easing.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();
                $('html,body').animate({scrollTop: $(this.hash).offset().top}, 1200);
            });
        });
    </script>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0, 0, 0); /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 30%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }
            to {
                top: 0;
                opacity: 1
            }
        }

        @keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }
            to {
                top: 0;
                opacity: 1
            }
        }

        /* The Close Button */
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-header {
            padding: 2px 16px;
            color: Black;
        }

        .modal-body {
            padding: 2px 16px;
        }

        .modal-footer {
            padding: 2px 16px;
            color: white;
        }

        .input-category {
            margin-top: 13%;
        }

        .input-field {
            height: 40px;
        }

        #food-modal {
            z-index: 99999999999;
        }
    </style>
    <script src="js/simpleCart.min.js"></script>
</head>
<body>
<!-- header-section-starts -->
<div class="header">
    <div class="container">
        <div class="top-header">
            <div class="logo">
                <a href="index.html"><img src="images/logo7.png" class="img-responsive" alt=""/></a>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div class="menu-bar">
        <div class="container">
            <div class="top-menu">
                <ul>
                    <li><a href="admin.html">Manage Restaurants</a></li>
                    |
                    <li><a href="manage-orders.html">Manage Orders</a></li>
                    |
                    <li><a href="manage-foods.html">Manage Foods</a></li>
                    |
                    <li><a href="view-comments.html">View Comments</a></li>
                    |
                    <div class="clearfix"></div>
                </ul>
            </div>
            <div class="login-section">
                <ul id="userlog">
                    <!--<li><a onclick='logout()'>Logout</a></li>-->
                    <div class="clearfix"></div>
                </ul>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>


<div class="container" style="margin-top: 5%; margin-bottom: 5%">
    <h2>View Foods</h2>
    <p>All the foods that has registered with the system</p>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Food Id</th>
            <th>Food Name</th>
            <th>Food Category</th>
            <th>price</th>
            <th>Restaurant</th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>
</div>

<div id="food-modal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2 style="margin-top: 2%; margin-bottom: 2%">Add Food Category.</h2>
        </div>
        <div class="modal-body">
            <div class="food-div">
                <div class="input-category" style="margin-top: 5%">
                    <label>Food Title Id:</label><br>
                    <input id="title-id" class="col-lg-12 input-field" type="text">
                </div>
                <div class="input-category">
                    <label>Food Category:</label><br>
                    <input id="category" class="col-lg-12 input-field" type="text">
                </div>
                <!--<div class="input-category"></div>-->
                <div class="input-category" id="results">

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a class="btn btn-primary" style="margin-top: 2%; margin-bottom: 2%" onclick="add_food_category()">Add Food
                Category</a>
        </div>
    </div>

</div>

<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2 style="margin-top: 2%; margin-bottom: 2%">Add Food Item.</h2>
        </div>
        <div class="modal-body">
            <div class="food-div">
                <div>
                    <label>Food Id:</label><br>
                    <input class="col-lg-12 input-field" id="id" type="text">
                </div>
                <div class="input-category">
                    <label>Food Name:</label><br>
                    <input class="col-lg-12 input-field" id="name" type="text">
                </div>
                <div class="input-category">
                    <label>Food Category:</label><br>
                    <select class="col-lg-12 input-field" id="food-title">

                    </select>
                    <button class="btn btn-primary" onclick="openModal('new-category')" style="margin-top: 2%">Add New
                        Category
                    </button>
                </div>
                <div class="input-category" style="margin-top: 5%">
                    <label>Price:</label><br>
                    <input class="col-lg-12 input-field" id="price" type="text">
                </div>
                <div class="input-category">
                    <label>Restaurant:</label><br>
                    <select class="col-lg-12 input-field" id="restaurants">
                    </select>
                </div>
                <div class="input-category">
                    <label>Select Image: </label>
                    <input id="image-file" type="file" class="form-control"/>
                </div>
                <div class="input-category" id="result-msg"></div>
            </div>
        </div>
        <div class="modal-footer">
            <a class="btn btn-primary" style="margin-top: 2%; margin-bottom: 2%" onclick="addFood()">Add Food</a>
        </div>
    </div>

</div>
<div class="container" style="margin-top: -5%; margin-bottom: 5%">
    <button class="btn btn-primary" onclick="openModal('new-food')">Add Foods</button>
</div>

<!-- footer-section-starts -->
<div class="footer">
    <div class="container">
        <p class="wow fadeInLeft" data-wow-delay="0.4s">&copy; 2019 All rights Reserved | by &nbsp;<a
                href="http://w3layouts.com" target="target_blank">EasyFood.lk</a></p>
    </div>
</div>


<div id="remove-modal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2 style="margin-top: 2%; margin-bottom: 2%; text-align: center ">Warning</h2>
        </div>
        <div class="modal-body">
            <h2 style="text-align: center; margin-top: 2%">Do you want to delete this food ?</h2>
        </div>
        <div class="modal-footer">
            <a class="btn btn-success" style="margin-top: 2%; margin-bottom: 2%" onclick="deleteFood()">Yes</a>
            <a class="btn btn-danger" style="margin-top: 2%; margin-bottom: 2%"
               onclick="document.getElementById('remove-modal').style.display = 'none'">No</a>
        </div>
    </div>

</div>

<script src="js/cookie.js"></script>
<!-- footer-section-ends -->
<script type="text/javascript">
    $(document).ready(function () {
        /*
        var defaults = {
              containerID: 'toTop', // fading element id
            containerHoverID: 'toTopHover', // fading element hover id
            scrollSpeed: 1200,
            easingType: 'linear'
         };
        */

        $().UItoTop({easingType: 'easeOutQuart'});

    });
</script>

<script type="text/javascript">

    var modal = document.getElementById('myModal');
    var food_modal = document.getElementById('food-modal');
    var remove_modal = document.getElementById('remove-modal')

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    function openModal(value) {
        if (value === 'new-food') {
            modal.style.display = "block";
        } else if (value === 'new-category') {
            food_modal.style.display = "block";
        } else if (value === 'remove'){
            remove_modal.style.display = 'block';
        }
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        } else if (event.target == food_modal) {
            food_modal.style.display = "none";
        }
    }

    $(window).load(function () {

        const Http = new XMLHttpRequest();
        const url = 'http://localhost:8080/api/v1/foods';
        Http.open("GET", url);
        Http.send();
        Http.onreadystatechange = (e) =>
        {
            if (Http.readyState === 4 && Http.status === 200) {
                var foods = JSON.parse(Http.responseText)
                console.log(foods);
                for (food in foods) {
                    $('#table-body').append(
                        "<tr>\n" +
                        "<td>"+foods[food].foodId+"</td>\n" +
                        "<td>"+foods[food].foodName+"</td>\n" +
                        "<td>"+foods[food].foodTitle.titleId+" - "+foods[food].foodTitle.name+"</td>\n" +
                        "<td>"+foods[food].price+"</td>\n" +
                        "<td>"+foods[food].restaurantDtoList.restaurantId +" - "+foods[food].restaurantDtoList.restaurantName+"</td>\n" +
                        "<td><i class=\"fa fa-pencil\"></i></td>\n" +
                        "<td><i onclick='remove_food("+foods[food].foodId+")' class=\"fa fa-times\"></i></td>\n" +
                        "</tr>"
                    )

                }
            }

        }
    });

    var foodId = 0;

    function remove_food(value){
        foodId = value;
        console.log("workiing")
        openModal('remove');
    }

    function deleteFood(){
        const Http = new XMLHttpRequest();
        const url = 'http://localhost:8080/api/v1/foods/'+foodId;
        Http.open("DELETE", url);
        Http.send();
        Http.onreadystatechange = (e) =>
        {
            if (Http.readyState === 4 && Http.status === 200) {
                console.log(Http.responseText);
            }

        }
    }

    $(window).load(function () {
        const Http = new XMLHttpRequest();
        const url = 'http://localhost:8080/api/v1/restaurants';
        Http.open("GET", url);
        Http.send();
        Http.onreadystatechange = (e) =>
        {
            if (Http.readyState === 4 && Http.status === 200) {
                var restaurants = JSON.parse(Http.responseText);
                console.log(restaurants)
                for (restaurant in restaurants) {
                    $('#restaurants').append(
                        "<option>" + restaurants[restaurant].restaurantId + " - " + restaurants[restaurant].restaurantName + "</option>"
                    );
                }
            }

        }
    });

    $(window).load(function () {
        load_category('');
    });

    function load_category(value) {
        const Http = new XMLHttpRequest();
        const url = 'http://localhost:8080/api/v1/foods-title';
        Http.open("GET", url);
        Http.send();
        Http.onreadystatechange = (e) =>
        {
            if (Http.readyState === 4 && Http.status === 200) {
                var food_titles = JSON.parse(Http.responseText);
                if (value === 'remove') {
                    remove_elements(food_titles);
                }
                for (food_title in food_titles) {
                    $('#food-title').append(
                        "<option id='"+food_titles[food_title].titleId+"'>" + food_titles[food_title].titleId + " - " + food_titles[food_title].name + "</option>"
                    );
                }
            }

        }
    }

    function remove_elements(food_titles) {
        var count = food_titles.length;
        console.log(count)
        for (food_title in food_titles) {
            $('#'+food_titles[food_title].titleId).remove();
            if (food_title == count){
                break;
            }
        }
    }

    function add_food_category() {
        var titleId = $('#title-id').val();
        var category = $('#category').val();

        const Http = new XMLHttpRequest();
        const url = 'http://localhost:8080/api/v1/foods-title/add';

        Http.onreadystatechange = (e) =>
        {
            if (Http.readyState === 4 && Http.status === 200) {
                if (Http.responseText === 'true') {
                    $('#result-content').remove();
                    $('#results').append(
                        "<div class=\"alert alert-success\" id='result-content' role=\"alert\">\n" +
                        "Food Category Added Successfully\n" +
                        "</div>"
                    )
                    console.log("success")
                } else {
                    $('#result-content').remove();
                    $('#results').append(
                        "<div class=\"alert alert-danger\" id='result-content' role=\"alert\">\n" +
                        "Something Went Wrong!" +
                        "</div>"
                    )
                    console.log("failed")
                }
            }
        }

        Http.open("POST", url);
        Http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        Http.send(JSON.stringify({
            "titleId": titleId,
            "name": category,
        }));

        load_category('remove');
    };
    
    function addFood() {
        var imageFile = document.getElementById("image-file").files[0];
        var reader = new FileReader();
        reader.readAsDataURL(imageFile);
        reader.onload = function () {
            var image = reader.result;
            var name = $('#name').val();
            var price = $('#price').val();
            var food_title = $('#food-title').val();
            var restaurant = $('#restaurants').val();
            var id = $('#id').val();

            console.log(food_title.split('-')[0]);
            console.log(restaurant.split('-')[0]);

            const Http = new XMLHttpRequest();
            const url = 'http://localhost:8080/api/v1/foods/add';

            Http.onreadystatechange = (e) => {
                if (Http.readyState === 4 && Http.status === 200) {
                    if (Http.responseText === 'true') {
                        $('#result-cont').remove();
                        $('#result-msg').append(
                            "<div class=\"alert alert-success\" id='result-cont' role=\"alert\">\n" +
                            "Food Added Successfully\n" +
                            "</div>"
                        )
                        console.log("success")
                    } else {
                        $('#result-content').remove();
                        $('#result-msg').append(
                            "<div class=\"alert alert-danger\" id='result-cont' role=\"alert\">\n" +
                            "Something Went Wrong!" +
                            "</div>"
                        )
                        console.log("failed")
                    }
                }
            }

            Http.open("POST", url);
            Http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            Http.send(JSON.stringify({
                "foodId": id,
                "foodName": name,
                "price": price,
                "foodTitle": {
                    titleId: food_title.split('-')[0]
                },
                "image": image,
                "restaurantDtoList": {
                    restaurantId: restaurant.split('-')[0]
                }
            }));
        }
        reader.onerror = function (error) {
            console.log('Error: ', error);
        };
    }

    $(document).ready(function () {
        var log = getCookie("logged");
        console.log("working")
        if (log === 'hasLogged') {
            $('#userlog').append("<li><a onclick='logout()'>Logout</a></li>");
        }else {
            location.href = 'index.html';
        }
    });

    function logout() {
        eraseCookie('logged');
        eraseCookie('user');
        location.href = 'index.html'
    }

</script>
<a href="#" id="toTop" style="display: block;"> <span id="toTopHover" style="opacity: 1;"> </span></a>

</body>
</html>

</body>
</html>
